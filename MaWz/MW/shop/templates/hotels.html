{% extends "base.html" %}
{% block container-block  %}
<input type="hidden" id="csrf_token" value="{{ csrf_token }}">

	<div class="site-mobile-menu site-navbar-target">
		<div class="site-mobile-menu-header">
			<div class="site-mobile-menu-close">
				<span class="icofont-close js-menu-toggle"></span>
			</div>
		</div>
		<div class="site-mobile-menu-body"></div>
	</div>

	<nav class="site-nav mt-3">
		<div class="container">

			<div class="site-navigation">
				<div class="row">
					<div class="col-6 col-lg-3">
						<a href="index.html" class="logo m-0 float-start">Sterial</a>
					</div>
					<div class="col-lg-6 d-none d-lg-inline-block text-center nav-center-wrap">
						<ul class="js-clone-nav  text-center site-menu p-0 m-0">
							<li><a href="index.html">Home</a></li>
							<li><a href="about.html">About us</a></li>
							<li class="has-children">
								<a href="#">Dropdown</a>
								<ul class="dropdown">
									<li><a href="#">Menu One</a></li>
									<li class="has-children">
										<a href="#">Menu Two</a>
										<ul class="dropdown">
											<li><a href="#">Sub Menu One</a></li>
											<li><a href="#">Sub Menu Two</a></li>
											<li><a href="#">Sub Menu Three</a></li>
										</ul>
									</li>
									<li><a href="#">Menu Three</a></li>
								</ul>
							</li>
							<li><a href="services.html">Services</a></li>
							<li class="active"><a href="blog.html">Blog</a></li>

						</ul>
					</div>
					<div class="col-6 col-lg-3 text-lg-end">
						<ul class="js-clone-nav d-none d-lg-inline-block text-end site-menu ">
							<li class="cta-button"><a href="contact.html">Contact Us</a></li>
						</ul>

						<a href="#" class="burger ms-auto float-end site-menu-toggle js-menu-toggle d-inline-block d-lg-none light" data-toggle="collapse" data-target="#main-navbar">
							<span></span>
						</a>
					</div>
				</div>
			</div>
			
		</div>
	</nav>
	<!-- 헤더 부분 -->



	<div class="hero overlay">
		<div class="img-bg rellax">
			<img src="/static/images/hero_2.jpg" alt="Image" class="img-fluid">
		</div>
		<div class="container">
			<div class="row align-items-center justify-content-start">
				<div class="col-lg-6 mx-auto text-center">

					<h1 class="heading" data-aos="fade-up"> Hotel</h1>
					<p class="mb-4" data-aos="fade-up">현지의 예약 가능한 호텔 중 KOAT가 엄선한 호텔을 알려드립니다.</p>

					<div data-aos="fade-up">
						<a href="https://www.agoda.com/ko-kr/?cid=1844104&ds=ZSDqvtarS5VJu5HZ" target="_blank" style="font-weight: 600; color: azure;">
							<div class="d-inline-flex align-items-center ">
								<span class="icon-button me-3">
									<span class="icon-play"></span>
								</span>
								<span class="caption">예약 사이트로 이동</span>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>

		
	</div>
<!-- 상단 부분 -->

<div class="section">
	<div class="container">
		<div class="col-12">
			<form action="{% url 'shop:hotels' %}" method="post" name="hotels">
				<input type="text" id="hotelInput" class="form-control" placeholder="도시, 체크인 날짜, 체크아웃 날짜, 방 개수, 어른 명수, 아이 명수 ex)서울(14690),2024-12-19,2024-12-24,1,2,0">
			</br>
				<input type="button" id="hotelBtn" value="Search" class="btn btn-primary dpchk">
			</form>
		</div>
		<br>

		<div class="row flex-container" id="hotel_list">
			<!-- 여기에 호텔 데이터가 추가됩니다 -->
		</div>
	</div>
</div>

<script>
	$(document).ready(function() {
    $("#hotelBtn").off('click').on('click', function() {
      loadHotelData();
		function getCSRFToken() {
			return $('#csrf_token').val();
		}

		function loadHotelData() {
			const inputData = $("#hotelInput").val();
			const hotelList = $("#hotel_list");
			hotelList.innerHTML = '<p>로딩 중...</p>'; // 로딩 메시지 추가
			
			const [cityName, checkIn, checkOut, rooms, adults, children] = inputData.split(',').map(x => x.trim());
			
			fetch('/shop/api/hotels/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': getCSRFToken() // CSRF 토큰 추가
					// 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36'
				},
				body: JSON.stringify({
					city_name: cityName,
					check_in: checkIn,
					check_out: checkOut,
					rooms: rooms,
					adults: adults,
					children: children
				})
			})
			.then(response => {
				if (!response.ok) {
					return response.text().then(text => { throw new Error(`에러 발생: ${text}`); });
				}
				return response.json();
			})
			.then(data => {
				hotelList.html(''); // 기존 데이터를 지우기
				if (!data.data.length) {
						// 조건에 부합하는 호텔이 없는 경우
						hotelList.html('<h2 style="color: gray;">조건에 부합하는 호텔이 없습니다.</h2>');
						return; // 더 이상 아래 코드를 실행하지 않음
				}
				if (data.status === 'error') {
					throw new Error(data.message);
				}	
				
				data.data.forEach((hotel, index) => {
					const div = document.createElement('div');
					div.classList.add('col-6', 'col-sm-6', 'col-md-6', 'col-lg-3', 'mb-4');
					div.innerHTML = `
					<div class="media-entry">
												<img src="${hotel.hlink}" alt="Image" class="img-fluid" style="width: 260px; height: 190px;">
												<div class="bg-white m-body">
													<h3><a>${hotel.name}</a></h3>
													<p>${hotel.cost}₩</p>
													</div>
													</div>
							`;
							hotelList.append(div);
						});
					})
					.catch(error => {
						hotelList.innerHTML = `<p>에러 발생: ${error.message}</p>`;
						console.error('에러 발생:', error);
					});
				}
		});
	}); //제이쿼리
</script>



{% endblock container-block  %}
			


{% comment %} c참고 {% endcomment %}
{% comment %}
# 기본적인 검색 url
https://www.agoda.com/ko-kr/search?city=14690&checkIn=2024-12-17&checkOut=2024-12-30&rooms=1&adults=2&children=0

# ko-kr : 국가-언어. 일본은 ja-jp, 영어는 공백
# 기본은 ko-kr고정(ip 기반인 듯)

# search?

city = 도시 코드
서울 = 14690
부산 = 17172
인천 = 17234
대전 = 17233
대구 = 17232
울산 = 10137
광주 = 19042
세종 = 213180

# checkIn : 체크인 날짜 (YYYY-MM-DD)
# checkOut : 체크아웃 날짜 (YYYY-MM-DD)
# rooms : 방 개수
# adults : 성인
# children : 아이
{% endcomment %}